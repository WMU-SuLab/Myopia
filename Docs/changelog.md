# 版本记录

## Common

- 0.0.1:2022-04-09
    - 初始化项目、架构、框架、文档等
    - 完成了导入学生数据的脚本
- 0.0.2:2022-04-11
    - 重构了response的规范和文件结构，并完善了异常处理机制
- 0.0.1:2022-04-09
    - 完成了初步的报告页面、生成函数、导出脚本、小程序对应接口
- 0.0.2:2022-04-11
    - 基于新规范完成了获得报告的数据处理机制，并补全了数据，
    - 完成了报告页面的生成和下载接口
    - 增加了基于pydantic的验证器
- 0.0.3:2022-04-12
    - 完善了数据库中的用户模型、学生角色模型、教师角色模型和微信角色模型
    - 将所有报告相关部分都区分为了学生和教师
    - 增加了微信相关的小程序配置、微信用户身份获取和数据解析方法
    - 增加了节流部分
    - 增加了公共的ViewModel部分
    - 补重了部分code定义
    - 增加了初步的环境依赖文件
    - 增加了运维文档
    - 补充了README.md文档
- 0.0.4:2022-04-13
    - 增加员工和管理员角色定义
    - 完善报告数据获取流程
    - 修复环境文件错误，添加新的环境依赖文件
- 0.0.5:2022-04-14
    - 添加基于Poetry的环境依赖文件
    - 为用户数据导入增加了重复导出处理
        - 迁移了数据导出函数位置
    - 新增了基于simpleui的配置部分
    - 重新调整了user_service的api结构
    - 购买域名，配置SSL证书
    - 完善了部署到服务器上的MYSQL、NGINX、Redis、Supervisor配置部分
    - 迁移数据库和隐私配置到环境变量中
    - 修复导入学生数据时候的一些bug
- 0.0.6:2022-04-15
    - 增加了邮件处理模块、服务器邮件配置
    - 解决了时区问题
- 0.0.7:2022-04-17
    - 修复学生数据中的学号导入问题
    - 更改user模型中gender的数据类型
- 0.0.8:2022-04-18
    - 完善supervisor、nginx、gunicorn配置文件
    - 完成MySQL数据导入
    - 将项目首页临时重定向为simpleui admin
    - 增加对于pydantic验证错误的异常处理
    - 增加问题记录文档
    - 为poetry换源
- 0.0.9:2022-04-19
    - 修复gunicorn配置文件的错误
    - 完善邮件配置
    - 完善环境配置规范，尤其是对数据库部分作出大量更改
    - 完善NGINX配置文件
    - 完善ops文档
    - 为知情同意书、眼底照、测序模型表更改了字段
- 0.0.10:2022-04-20
    - 首页重定向重新改为后台管理系统，而非simpleui默认后台
- 0.0.11:2022-04-21
    - 增加 serializers 模块
    - 调整utils 模块中 email 模块的结构
- 0.0.12:2022-04-22
    - 增加加密解密模块
    - 在项目配置文件中增加Hash部分配置
    - 调整开发配置中的在本地的邮件相关配置
- 0.0.13:2022-04-24
    - 增加基于Session的用户身份验证系统
    - 调整 user_service 用户认证模块的位置
- 0.0.14:2022-04-25
    - 添加了自定义的认证后端，增加了验证邮箱、手机号的功能
    - 完善了对于用户管理员身份认证的验证
- 0.0.15:2022-04-26
    - 添加了测试环境配置
    - 添加了基于 Vue3 的 ElementPlus 模板
    - 修复createsuperuser的bug
    - 修复验证后端对于验证用户是否存在的bug
- 0.0.16:2022-04-27
    - 切换电脑验光仪为Optometry，并修复了各个地方的名称问题
    - 添加了layui框架和layuimini后台管理框架的资源文件
- 0.0.17:2022-04-28
    - 完善了测试环境配置，规范了其他环境配置，并完善了运维文档
    - 添加了创建用户的快捷命令
    - 完善了日志管理部分
    - 添加测试服务器的nginx配置文件
    - 完善关于supervisor和NGINX的运维文档
- 0.0.18:2022-05-03
    - 完善了创建用户相关脚本
    - 初始化权限、用户组和用户相关脚本
    - 添加了permissions相关模块
    - 调整了token相关serializers位置
    - 创建了Common中的admin，完成了User数据库表的配置
- 0.0.19:2022-05-05
    - 调整了部分admin的配置，增加了UserAdmin对于用户权限的处理
    - 完善了初始化脚本和创建用户脚本
    - 完善了用户模型身份判断的方法
    - 完善了数据库模型相关的 serializers
    - 修复了BootStrap4的Popper库问题
    - 添加针对用户组更加完善的节流配置
    - 修复各个模型FilePathField为CharField
- 0.0.20:2022-05-06
    - 增加了通用的随机函数
        - 为用户增加随机的默认用户名、openID、密码
    - 增加了通用的对ObjectDoesNotExist处理的装饰器
        - 完善了对于用户的身份验证属性
    - 优化了数据库相关的 serializers，增加了对应正向和反向关联的处理
    - 完善了导出项目数据的函数
    - 增加了通用的choices逆函数
- 0.0.21:2022-05-11
    - scripts
        - 用户导入数据脚本中字段调整，添加分组
    - models
        - 项目更改完成字段为进度字段
        - 添加对于status的过滤
    - serializers
        - 为拥有choices属性的字段添加对应的显示字段
        - 完成BaseSerializer并为所有序列化器使用
        - 调整Base级别的序列化器到base模块方便同时进行正反向关联
- 0.1.0:2022-05-23
    - **开始制作后台管理和采样小程序**
    - 更新员工权限初始化设置
    - 为project模型增加一些计算属性
    - 调整基本和部分serializers和的required设置
    - 更新部分viewModel
    - 调整permissions模块为models模式，增加equipments模块相应的权限
    - 自定义了增加get方法认证的DjangoModelPermissions等
    - 完善对于使用rest frame work内置成功和异常返回的处理
    - 增加对应的GenericAPIView
    - 增加了部分自定义exceptions
- 0.1.1:2022-05-26
    - 修复了HTTPResponse 的Pydantic模型验证的问题和传输数据的问题
    - 完善了sequence相关的数据字段
    - 修复了Token相关权限的问题
    - 删除了Common中测试用的user接口
    - 增加国家地区相关的模型，更改用户模型中相应的字段，增加了相应的初始化数据、初始化脚本、admin、serializers和API
    - 增加了下载文件和图片的通用接口
    - 添加初始化文件夹的脚本
- 0.1.2:2022-05-31
    - 增加了FileNotFound exceptions
    - 完善了drf的parser相关配置
    - 删除了对于token的不同身份的认证，换为通用的用户认证
    - 大范围调整了APIView和相关认证方法，全部放到了Common APP中
- 0.1.3:2022-06-01
    - 删除其他APP的用户token相关接口，重新在Common APP构建用户相关token接口
    - 增加了语言、民族、种族、人种数据库表，对用户表增加了民族和受教育程度字段
    - 增加了民族和受教育程度的查询接口
    - 删除其他APP的test接口
    - 在Common中增加data数据文件夹，大幅度调整libs文件夹，在配置中增加文件夹路径配置
        - 重新编写了初始化脚本相关部分
        - 调整了各个接口中的路径相关配置
    - 调整了加密解密相关的部分接口到Common APP中
    - 增加了文件相关处理函数
- 0.1.4:2022-06-07
    - 大范围更新了限流配置
    - 更新了poetry依赖环境
    - 删除小程序相关配置
- 0.1.5:2022-06-13
    - 增加了输出原始JSON的生成器，修复后台界面错误
    - 增加了数据库时区问题的文档
- 0.1.6:2022-06-18
    - 修复了project中处理ObjectNotExist装饰器顺序错误的问题
    - 增加了字符串转int通用函数
    - 去除了自己写的JSON_MIDDLEWARE
    - 增加了更多的文件夹的配置
    - 增加了保存知情同意书的共用名称函数
    - 修改了前提条件不足的exception类
    - 增加了知情同意书HTML版本
    - 增加了未完成的dockerfile
    - 完善了上传文件的函数
    - 增加了重命名文件和目录的通用函数
- 0.2.0:2022-06-21
    - 自定义Token函数，全部更改为Http Only的方式
    - 调整了viewModels中的equipments模块结构，并调整相应模块调用
    - 增加了通用的上传知情同意书和测序文件的viewModel方法
- 0.2.1:2022-06-24
    - 优化response代码
    - 优化supervisor.ini配置
    - 修复http json render的data不能为空的bug
- 0.2.2:2022-06-26
    - 为用户token验证增加了确认用户是否存在的验证，防止用户不存在的情况还在操作
- 0.2.3:2022-06-29
    - 切换static文件夹到根目录下，并修改相关配置文件
    - 删除NGINX无用域名配置
    - 大幅度调整了template base页面的基础结构，并调整了相应页面的结构
    - 删除了曾经错误的BootStrapTable引入资源文件的页面
    - 添加了layui-vue的模板框架
    - 调整了Employee和Manager相关APIView到Common APP中
- 0.3.0:2022-07-05
    - 增加了缓存
        - 使用redis数据库
        - 增加了缓存通用调用接口
    - 增加了验证码
        - 增加了生成验证码的接口
        - 增加了和数据库交互验证码的接口
        - 增加了阿里云客户端和验证码服务器的配置
        - 增加了使用验证码注册、登录、重置密码相关的手机和邮箱接口
        - 增加了阿里云和验证码相关的配置和环境变量设置
        - 增加了相关成功和错误提示信息
    - 数据库更改
        - 将所有的phone字段更改为phone_number
    - 增加了相关环境文件配置
- 0.3.1:2022-07-10
    - 添加后台索引页面
    - 为下载文件接口增加了gzip压缩功能
    - 因为要增加oss，调整了阿里云相关模块的结构
- 0.3.2:2022-07-18
    - 完善了阿里云OSS相关模块
        - 增加了阿里云OSS相关的环境变量设置
        - 环境中添加了相对路径的配置
        - 添加相关成功和失败类
        - 为所有上传添加了OSS保存机制
            - 增加了大量通用处理函数
        - 为所有下载添加了OSS下载机制
            - 为下载文件添加了通用处理
            - 重构了下载图片的逻辑
    - 修改报告生成逻辑
    - 完善了读取文件函数
    - 增加了集合相关函数
- 0.3.3:2022-07-19
    - 修复处理oss的示例代码

# Screening

- 0.0.1:2022-04-14
    - 完成了整个screening的框架
- 0.0.2:2022-04-20
    - 修改manage的接口
    - 将manage页面首页临时改为login
- 0.0.3:2022-04-25
    - 增加了用户登录、重定向、验证功能
    - 增加了首页，重新安排了模板的结构
- 0.0.4:2022-04-26
    - 创建了基于 element-plus 模板的首页
- 0.0.5:2022-04-27
    - 添加了基于layuimini框架的基础页面
    - 增加了menus配置文件
    - 增加了菜单栏中需要的各个页面的路由
    - 调整了部分模板的位置和资源路径
- 0.0.6:2022-05-03
    - 完善了需要登录的APIView类
    - 调整了后台管理中的menus配置和相关页面以及路由
- 0.0.7:2022-05-23
    - 增加采样小程序接口
        - 员工登录相关接口
        - 仪器的查、增、改
        - 员工对应权限验证
- 0.0.8:2022-05-26
    - 优化了管理员和筛查员相关的接口名称
    - 优化了筛查员token相关权限验证
- 0.0.9:2022-06-20
    - 筛查小程序
        - 调整了Project获取信息的内容
        - 修复了获取不到信息的错误
        - 禁用了put方法
        - 完善了前提条件判断
        - 将知情同意书和测序文件转为自定义操作，而非通用操作，后续需要改进
- 0.0.10:2022-06-21
    - 处理了知情同意书和测序文件的自定义操作

## UserService

- 0.0.1:2022-04-14
    - 完成了user_service的框架
    - 完善了报告相关的接口
- 0.0.2:2022-04-15
    - 为报告的建议部分细分了等级，更改了返回的数据结构
    - 为查找不到数据提供了咨询接口，发送邮件告知管理员
- 0.0.3:2022-04-17
    - 修复邮件发送问题
    - 修复没有加api_view导致的异常处理不生效问题
    - 修复学生报告模板继承问题
    - 迁移学生报告文件位置，修复文件夹不存在问题
    - 修复报告生成数据不全和错误问题
- 0.0.4:2022-04-18
    - 使用pydantic为report所有的请求参数增加校验功能
    - 增加api/test的能力
    - 修改报告模板的字段student为user，更加通用
- 0.0.5:2022-04-21
    - 调整报告接口为通用用户接口，并基于pydantic写了一套验证方法
    - 为报告字段中增加下载链接
    - 重写发送学生反馈接口为通用用户反馈方法
    - 调整发送邮件的模块结构
- 0.0.6:2022-04-22
    - 美化报告页面中的建议部分
    - 增加hash处理模块
    - 调整用户反馈接口
    - 调整下载报告接口，存储临时的报告url
    - 添加反馈数据库，将用户反馈存储起来
    - 调整反馈各个函数和模块的位置结构，解耦
- 0.0.7:2022-04-23
    - 取消报告强制提交姓名
    - 解耦获取报告数据的函数
- 0.0.8:2022-04-25
    - 修复矫正视力数据错误的问题
- 0.0.9:2022-04-26
    - 修复下载报告对于名称的验证导致失败的问题
    - 修复发送邮件没有成功提示的问题
- 0.0.10:2022-05-05
    - 调整了生成报告和获取报告文件接口和函数的逻辑
    - 调整了相关project模型的字段
- 0.0.11:2022-05-06
    - 优化报告接口的逻辑
    - 重新定义报告文件名称
    - 完善批量生成和合并PDF的脚本
- 0.0.12:2022-05-17
    - 完善了处理报告的脚本
        - 增加clean功能
        - 完善合并功能
    - 调整了报告接口部分执行逻辑
    - 修复等效球镜没有计算的错误
- 0.0.13:2022-05-31
    - 添加了自采样相关的接口
- 0.0.14:2022-06-13
    - 解决了用户查询报告需要登录的问题
- 0.0.15:2022-06-18
    - 完善用户自筛查上传知情同意书的逻辑
    - 为查询报告增加了完善知情同意书的功能
        - 增加了上传知情同意书的接口
        - 为原数据增加了知情同意书的字段
- 0.0.16:2022-06-20
    - 增加了查询多个项目的接口
    - 增加了对project_id查询的处理
- 0.1.0:2022-06-21
    - 为用户自采样增加初次戴镜时间
    - 优化了用户自采样知情同意书的处理逻辑
    - 调整了报告小程序上传知情同意书的逻辑
- 0.1.1:2022-06-24
    - 为微信小程序提供post版本的更新方法
    - 优化更新的逻辑，无提交数据不更新
    - 修复用户自采样小程序project更新未保存的bug
    - 增加用户反馈方式查询接口
    - 优化用户反馈接口
    - 增加自采样表单序列号规则验证
    - 优化自采样表单不需要提交的逻辑
        - 优化自采样数据库模型验证
- 0.1.2:2022-06-25
    - 为多个测序编号增加时间字段
- 0.1.3:2022-06-27
    - 调整表单信息到project.remarks_json字段中，并修复各相应赋值方法
- 0.1.4:2022-06-29
    - 为报告小程序查询项目增加更多信息
    - 为自采样小程序增加管理后台雏形
        - 添加了新的分组
        - 添加了权限
        - 添加了相关基类View
        - 添加了登录页面和登录接口
- 0.1.5:2022-06-30
    - 修复了命令行创建PDF文件的错误
        - divide判断错误
        - 没有添加user键值
    - 增加对矫正视力的提示
- 0.1.6:2022-07-04
    - 增加了自采样后台
        - 增加了相关页面
        - 增加了相关接口
- 0.2.0:2022-07-05
    - 增加了发送注册和重置密码短信的接口
- 0.2.1:2022-07-10
    - 为报告下载增加根据url进行处理的功能
- 0.2.2:2022-07-18
    - 解耦了项目和知情同意书上传逻辑
    - 简化了创建和更新数据逻辑
- 0.2.3:2022-07-19
    - 修复自采样上传和更新数据逻辑问题
        - 处理表格中的文件字段，不能转化为JSON
        - 处理字典键值生成顺序
    - 调整判断是否是图片文件的逻辑顺序
- 0.2.4:2022-08-24
    - 为自采样增加导出所有用户数据功能
- 0.3.0:2022-11-12
    - 因为业务调整，对项目的Screening和UserService两个APP进行了重构
        - 将UserService的报告迁移到Screening
        - 新建Sample APP，将UserService的自采样部分迁移到Sample，并删除UserService APP
        - Screening现在为高度近视筛查，有两个小程序和一个管理后台
        - Sample现在为谱希基因公司项目，有一个采样小程序和一个管理后台
        - 大量接口重新调整
        - 数据库模型重新调整
        - 添加角膜营养不良相关的产品接口
    - 添加验证码登录接口，重构了登录接口验证逻辑
    - 用户反馈接口调整，主要为每个小程序设置不同的反馈方式
    - 谱希基因采样后台页面和接口调整
    - 将choices部分从model和form中独立出来，放到Common/libs/choices.py中
    - 处理遗留的文件注释中文件名的错误
    - 处理微信相关数据库表，为后续的微信一键登录功能做铺垫
- 0.3.1:2022-11-14
    - 处理手机号注册时，会被用户名影响的逻辑
    - 为顺丰快递接口增加了备注字段
    - 查询项目的时候增加项目名称字段和过程字段
    - 存储顺丰返回的信息，主要留出订单号
    - 增加注册、登录两用验证码和对应的注册登录接口
    - 优化登录注册接口的代码和表单
    - 请求返回数据结构处理优化
    - 增加验证码类型，增加验证码类型判断
- 0.3.2:2022-11-15
    - 完善验证码验证逻辑
        - 增加身份标识，和身份id一起进行验证，防止重复的身份id
        - 使用不覆盖型验证码，虽然覆盖的代码简单，但是会导致验证码的浪费，一旦被攻击也容易导致用户无法使用
        - 验证码使用后不删除，减少负载，防止频繁使用
    - 修复表单验证中手机号的验证错误
        - 错误的调用了验证函数，应该使用表单模块中的验证器而不是文本处理中的验证器
    - 重写了 ORM 的get()方法，并对相应调用进行了修改
- 0.3.3:2022-11-16
    - 增加和谱希LIMS系统的对接接口
        - 发送订单通知
            - 由于对接公司未完全完成，故暂时注释掉
        - 接收报告
    - 增加微信一键登录接口
        - 重构微信相关数据库模型及其admin模型
        - 增加微信相关配置
        - 增加微信登录接口请求函数
        - 合并为注册并登录接口
    - 调整顺丰接口的位置到http模块中
    - 优化.gitignore文件
    - 增加测试服域名
    - 部署
        - 需要进行数据库迁移
        - 需要更新.env文件
- 0.3.4:2022-11-17
    - 处理了加密模块导入问题
    - 更新了部分环境和环境变量配置
    - 修复重写get后用户认证无is_active的错误
    - 修复TGFBI更新绑定表单和寄件表单写错位置的错误